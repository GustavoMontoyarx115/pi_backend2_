name: Update README

on:
  push:
    branches:
      - main
      - helpers

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Update README with last updated date and commits
        run: |
          # Guardamos contenido nuevo en un archivo temporal
          echo "<!-- AUTO-UPDATE:START -->" > update.txt
          echo "ðŸ“… Ãšltima actualizaciÃ³n: $(date '+%Y-%m-%d %H:%M:%S')" >> update.txt
          echo "" >> update.txt
          echo "## Ãšltimos commits" >> update.txt
          # Ãšltimos 5 commits con hash, mensaje, autor y fecha
          git log -5 --pretty=format:"- %h %s (ðŸ‘¤ %an, %ad)" --date=short >> update.txt
          echo "" >> update.txt
          echo "<!-- AUTO-UPDATE:END -->" >> update.txt

          # Reemplazamos el bloque en README.md
          sed -i -e '/<!-- AUTO-UPDATE:START -->/,/<!-- AUTO-UPDATE:END -->/{
            r update.txt
            d
          }' README.md

      - name: Commit changes
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add README.md
          git commit -m "ðŸ”„ ActualizaciÃ³n automÃ¡tica del README con fecha y Ãºltimos commits" || echo "No hay cambios que commitear"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
